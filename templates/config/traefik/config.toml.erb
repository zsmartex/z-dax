logLevel = "INFO"
defaultEntryPoints = [<%= '"https",' if @config['ssl']['enabled'] %>"http"]

[api]

[entryPoints]
  [entryPoints.http]
    address = ":80"
<% if @config['ssl']['enabled'] -%>
    [entryPoints.http.redirect]
      entryPoint = "https"
  [entryPoints.https]
    address = ":443"
  [entryPoints.https.tls]
    [entryPoints.https.redirect]
      regex = "^https://<%= @config['app']['domain'] %>/(.*)"
      replacement = "https://<%= @config['app']['subdomain'] %>.<%= @config['app']['domain'] %>/$1"
    [[entryPoints.https.tls.certificates]]
      certFile = "/ssl/ssl.crt"
      keyFile = "/ssl/ssl.key"
<% end -%>

[retry]

[consul]
endpoint = "consul-bootstrap:8500"

[docker]
endpoint = "unix:///var/run/docker.sock"
domain = "<%= @config['app']['domain'] %>"
watch = true
exposedbydefault = false
swarmmode = true

<% if @config['ssl']['enabled'] -%>
[acme]
email = "<%= @config['ssl']['email'] %>"
storage = "acme.json"
entryPoint = "https"
OnHostRule = true
usebindportip = true

[acme.httpChallenge]
entryPoint = "http"
<% end -%>